# ⚡ 进程管理 (Process Management)

掌握如何查看、控制和优化系统进程，是成为 Linux 高手的必经之路。

## 1. 进程监控 (ps / top / htop)

### ps - 静态快照
- **`ps aux | grep nginx`**：**最常用的组合**。查看 nginx 是否在运行，并找到它的 PID。
- `ps -ef`：标准格式查看所有进程。

### top - 实时监控
- **`top`**：实时显示系统资源使用情况。
  - **💡 内部快捷键**：
    - `P`：按 **CPU** 占用排序。
    - `M`：按**内存**占用排序。
    - `1`：切换显示每个 CPU 核心的详情。
    - `k`：直接在 top 中杀死进程 (需输入 PID)。
    - `q`：退出。

### htop - 现代化交互式监控 (推荐)
- 比 `top` 更直观，支持鼠标操作，自带色彩高亮。
- **安装**：`sudo apt install htop`

---

## 2. 终止进程 (kill)

当程序卡死或需要重启时，你需要“杀掉”它。

- **`kill PID`**：发送终止信号给指定 PID。
- **💡 核心：理解信号 (Signals)**
  - **`kill -15 PID` (SIGTERM)**：**优雅终止** (默认)。给程序写遗言的时间 (如保存文件、关闭数据库连接)。
  - **`kill -9 PID` (SIGKILL)**：**暴力杀死**。强制立即退出，可能导致数据丢失。**只有当程序卡死且 -15 无效时才使用**。
- **`pkill 进程名`**：按名称匹配并杀死进程。
- **`killall 进程名`**：杀死所有同名进程。

---

## 3. 后台任务管理 (Background Jobs)

- **`&`**：在命令末尾添加，使命令在后台运行。
  - `python server.py &`
- **`Ctrl + Z`**：挂起当前前台任务到后台 (暂停状态)。
- **`jobs`**：查看当前终端的所有后台任务。
- **`fg %n`**：将编号为 n 的任务调回前台 (foreground)。
- **`bg %n`**：让后台挂起的任务继续在后台运行 (background)。
- **`nohup 命令 &`**：让命令在退出终端后继续运行 (No Hang Up)。
  - `nohup python server.py > output.log 2>&1 &`

---

## 4. tmux - 终端复用器 (生产力之王)

`tmux` 解决两大痛点：
1. **防断连**：远程 SSH 断开后，任务仍在服务器后台运行，重新连上还能找回。
2. **多窗口**：在一个 SSH 连接里开多个分屏。

### 基础管理
- **`tmux new -s work`**：创建一个名为 "work" 的新会话。
- **`tmux detach`** (或快捷键 `Ctrl+B, d`)：退出会话，但**程序在后台继续运行**。
- **`tmux ls`**：列出所有后台会话。
- **`tmux a -t work`**：重新连接 (Attach) 到 "work" 会话。
- **`tmux kill-session -t work`**：彻底关闭会话。

### 常用快捷键
先按前缀键 **`Ctrl + B`**，松开后再按功能键：
- **分屏**：`%` 左右分屏，`"` 上下分屏。
- **导航**：`方向键` 在分屏间切换；`z` **最大化/还原**当前分屏 (神技)。
- **窗口**：`c` 创建新窗口，`n/p` 切换窗口。

> 💡 **Pro Tip**: 在 `~/.tmux.conf` 中加入 `set -g mouse on`，即可用鼠标调整分屏大小。

---

## 5. watch - 周期性执行
- **`watch -n 1 'ls -lh file.txt'`**：每秒刷新一次，观察文件大小变化。
- **`watch -d 'netstat -tulpn'`**：监控端口状态并**高亮变化的部分**。

---

## 🚀 性能排查全家桶：从发现到定位

当服务器出现拥堵或异常时，建议遵循以下递进逻辑进行排查：

1. **第一步：看大局 (`top` / `htop`)**
   - 确认是哪个资源（CPU、内存、I/O）遇到了瓶颈。
   - 找到占用最高的进程 PID。

2. **第二步：查细节 (`iostat` / `vmstat`)**
   - `iostat -x 1`：如果 `%iowait` 很高，说明磁盘太慢拖累了 CPU。
   - `vmstat 1`：如果 `si/so` (swap in/out) 持续有数据，说明内存不足。

3. **第三步：终极侦探 (`strace`)**
   - **`strace -p PID`**：观察进程正在进行的系统调用。
   - **场景**：程序没报错但没响应，通过 strace 发现它一直卡在 `read` 某个配置文件上。

> **🧗 进阶阅读**：
> 想要深入理解进程状态（如 D/Z 状态）和内存模型？
> 请阅读：[02_内核原理与调试](../05_高级/02_内核原理与调试.md)
