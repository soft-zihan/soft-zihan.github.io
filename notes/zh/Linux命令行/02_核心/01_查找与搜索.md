# 🔍 查找与搜索 (Search & Find)

## 1. find & fd - 查找文件 (经典 vs 现代)
`find` 是跨平台的标准工具，功能极广；`fd` 是现代化的替代者，速度更快且语法更简洁（自动忽略 `.git` 和 `.gitignore`）。

- **基础搜索**：
  - `find . -name "*.log"` (经典) vs `fd log` (现代)
  - `find . -type f -size +100M`：查找大于 100M 的**文件**。
  - **按时间搜索 (`-mtime`)**：
    - `find . -mtime -1`：**24 小时之内**修改过的。
    - `find . -mtime +1`：**超过 24 小时** (2天前) 修改过的。
    - `find . -mtime 1`：**刚好**在 24~48 小时之间修改过的。
  - `fd -e jpg`：按后缀搜索 (fd 特有简洁语法)。

- **逻辑运算**：
  - **OR (或者)**：`find . -name "*.jpg" -o -name "*.png"`
  - **NOT (排除)**：`find . -not -name "*.log"`

- **进阶：查找并执行**：
  - `find . -name "*.tmp" -exec rm -f {} \;`
  - **语法拆解**：
    - **`{}`**：这是一个占位符，代表 `find` 找到的每一个文件名。
    - **`\;`**：表示 `-exec` 参数的结束。反斜杠是为了防止 Shell 把分号解析成命令分隔符。
  - **`find . -name "*.tmp" -delete`**：(更简洁) 直接删除找到的文件。
  - `fd -e tmp -x rm -f` (fd 的并行执行 `-x` 效率极高)

- **💡 更多实战绝招**：
  - `find . -empty`：查找空文件或空目录。
  - `find . -perm 777`：查找权限为 777 的危险文件。
  - `find . -user root`：按所有者查找。
  - **正则搜索**：`find . -regextype posix-extended -regex '.*\\.(log|txt)$'` (使用正则表达式查找 log 或 txt 文件)。
  - **格式化输出**：`find . -type f -printf "%T@ %p\n" | sort -n` (按修改时间戳排序并列出文件)。

- **💡 专业建议：配合 `xargs` 使用**：
  - **为什么不用 -exec？**：`-exec` 像是一个强迫症：每找到一个文件，就启动一个新的进程去执行命令。如果你找到了 1 万个文件，系统就要启动 1 万个进程，开销巨大。
  - **`xargs` 的优势**：它像是一个高效搬运工：把 `find` 传来的 1 万个文件名打包，一次性传给 `rm` 命令，只启动一个或极少数进程，效率飞升。
  - **折中方案（更通用）**：`find . -name "*.log" -exec rm -f {} +` (用 `+` 让 find 自动批量执行，避免 xargs 的边界问题)。
  - `find . -name "*.log" | xargs rm -f`
  - **带空格的安全模式**：`find . -name "*.log" -print0 | xargs -0 rm -f` (防止文件名有空格导致命令误删)。

---

## 2. locate - 全系统秒查 (基于数据库)
- `locate filename`：不扫描磁盘，直接查数据库，速度极快。
- **工作原理**：Linux 系统通常每天会运行一个后台任务，把硬盘里的文件建个索引存进数据库。
- **注意**：如果你刚创建了一个文件，`locate` 会搜不到。
- **手动更新**：执行 `sudo updatedb` 强制让系统现在就去扫描磁盘并更新索引。

---

## 3. grep / rg - 搜索文件**内容**
虽然 `grep` 属于文本处理，但它常用于“查找包含特定字符串的文件”。

- **常见场景**：
  - `grep -rn "API_KEY" .`：在当前目录下递归 (`-r`) 搜索包含 "API_KEY" 的行，并显示行号 (`-n`)。
  - **`grep -rl "API_KEY" .`**：只列出**文件名** (`-l`)。
  - **`grep -o "正则"`**：**只输出匹配的部分** (Only matching)。
    - *场景*：从一堆 HTML 中提取所有的 URL。
    - `grep -o 'http://[^"]*' file.html`
- **现代化替代：`rg` (ripgrep)**：
  - `rg "keyword"`：速度比 grep 快几个量级，且默认忽略 `.gitignore` 里的干扰文件。

---

## 4. fzf - 模糊查找与交互
如果你记不清路径，`fzf` 是救星。
- `cd $(find . -type d | fzf)`：模糊搜索一个目录并跳转过去。
- `vim $(fzf)`：交互式搜索一个文件并用 Vim 打开。

---

## 5. lsof - 这里的“查找”是侦探级的 (LiSt Open Files)
`lsof` 不只是查端口，它是 Linux 里的顶级侦探，用来回答：“这个文件/资源到底被谁占用了？”

- **端口占用**：`lsof -i :8080` (谁占用了 8080 端口？)
- **文件占用**：`lsof /var/log/nginx/access.log` (谁正在往这个日志写东西？)
- **目录占用**：`lsof +D /mnt/data` (我想卸载挂载点，谁还在占用这个目录里的文件？)
- **进程追踪**：`lsof -p 1234` (PID 为 1234 的进程打开了哪些文件和库？)

---

## 6. which / type / whereis - 查找命令来源
- `which python`：查看 python 命令指向哪个路径。
- **`whereis ls`**：查找二进制程序、源码和帮助手册的位置。
- `type -a ls`：查看 ls 是别名还是原始二进制文件。如果你发现命令行为怪异，用 `type` 检查是否被设置了奇怪的 `alias`。

