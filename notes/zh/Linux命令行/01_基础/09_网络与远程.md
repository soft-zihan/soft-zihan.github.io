# 🌐 网络与远程 (Networking & Remote)

## 1. ping / telnet / nc - 连通性测试
- `ping host`：测试网络连通性。
  - **⚠️ 注意**：与 Windows 不同，Linux 下的 `ping` 会**一直运行**下去。按 **`Ctrl + C`** 停止，或者使用 `ping -c 4 host` 只发 4 个包。
- **`telnet IP Port`**：最基础的端口连通性测试 (如 `telnet 1.2.3.4 80`)。
- `nc -zv host port`：更现代的端口扫描工具 (Netcat)。

---

### 2. ufw - 简单防火墙管理 (Ubuntu)
如果你在云服务器上发现端口连不通，除了检查程序，还要检查防火墙。
- `sudo ufw status`：查看防火墙状态。
- `sudo ufw allow 80`：允许 80 端口进入。
- `sudo ufw enable`：启用防火墙。

---

### 3. ip / ifconfig / hostname - 地址与主机名
- **`ip addr`**：显示所有网卡 IP 地址 (现代标准，取代 `ifconfig`)。
- `ifconfig`：显示网卡信息 (旧版，需安装 `net-tools`)。
- **`ip route`**：显示路由表信息。
- `hostname`：查看或临时设置当前主机名。
- `hostname -I`：快速查看本机所有 IP。

### 4. netstat / ss / lsof - 端口与连接监控
- **`ss -tulpn`**：查看所有监听端口及对应进程 (推荐，比 `netstat` 更快)。
- `netstat -tulpn`：经典端口占用查看工具。
- **`lsof -i :端口号`**：查看特定端口被哪个进程占用。
- `sudo nethogs`：按进程查看实时网速占用 (需安装)。

---

### 5. curl / wget - 交互与下载
- `curl -I URL`：仅查看 HTTP 响应头。
- **`curl -O URL`**：下载文件并**保持原名**。
- **`curl -L URL`**：**跟随重定向** (当下载链接会自动跳转时必加)。
- **`curl -s https://api.example.com/data | jq`**：隐藏进度条并格式化输出 JSON。
- **💡 进阶：API 调试与复杂请求**
  - **添加 Header**：`curl -H "Content-Type: application/json" -H "Token: secret" URL`
  - **认证 (Basic Auth)**：`curl -u "user:password" URL`
  - **发送 POST 请求 (JSON)**：
    ```bash
    curl -X POST -d '{"name":"test"}' -H "Content-Type: application/json" URL
    ```
  - **超时设置**：`curl --connect-timeout 5 --max-time 20 URL` (连接超时 5s，总限时 20s)。
- `curl ifconfig.me`：在终端查看本机的**公网 IP**。
- `wget -c URL`：断点续传下载。

---

### 6. 快速文件共享 (Python HTTP Server)
当你需要把服务器上的文件传给同事，或在手机上下载服务器文件时：
- **`python3 -m http.server 8000`**
- **效果**：它会把当前目录变成一个网页。你只需在浏览器输入 `http://你的IP:8000` 即可直接下载目录下的文件。

---

### 7. nslookup / dig / nmap / mtr - 诊断与追踪
- `nslookup domain`：简单 DNS 查询。
- **`dig domain`**：**Domain Information Groper**。显示详细的 DNS 迭代查询过程。
- **`nmap <host>`**：**强大的扫描工具**。扫描目标主机开启了哪些端口和服务。
- **`mtr <host>` (My Traceroute)**：
  - **场景**：网站访问慢，你想知道是哪个节点出了问题。
  - **特点**：结合了 `ping` 和 `traceroute` 的实时统计，能清晰看到每一跳的丢包率。
- **`sudo tcpdump -i eth0`**：
  - **常见过滤组合**：
    - `tcpdump -i eth0 port 80`：只看 80 端口流量。
    - `tcpdump -i eth0 src 192.168.1.100`：只看特定来源 IP。
    - `tcpdump -i eth0 'tcp[tcpflags] & tcp-syn != 0'`：只看 SYN 包 (建立连接)。
  - **实用参数**：
    - `-nn`：不解析主机名和端口名 (显示数字，更快)。
    - `-A`：以 ASCII 打印包内容 (常用于看 HTTP 请求体)。
    - `-w file.pcap`：保存到文件，后续用 Wireshark 打开。
  - **特点**：命令行抓包神器，让你亲眼看到协议头。

---

### 8. ssh / scp / rsync - 远程操作与同步

#### SSH 基础
- `ssh user@host`：通过 SSH 远程登录。
- `ssh -p port user@host`：指定端口登录。

#### 文件传输
- **`scp file user@host:/path`**：**Secure Copy**，最基础的远程拷贝方式。
- **`rsync -avzP source/ user@host:/path`**：
  - `-a`：归档模式，保留权限和时间戳。
  - `-v`：显示详细过程。
  - `-z`：传输时压缩数据。
  - `-P`：显示进度 (`--progress`) 且支持断点续传 (`--partial`)。
- **⚠ 极度重要：末尾斜杠 (Trailing Slash) 的陷阱**
  - **有斜杠**：`rsync -a src/ dest/` 意思是“把 `src` **目录下的内容**拷贝到 `dest`”。
  - **无斜杠**：`rsync -a src dest/` 意思是“把 `src` **整个目录本身**拷贝到 `dest`”。
  - *后果*：如果你少写一个斜杠，可能会在目标路径多出一层名为 `src` 的文件夹。

#### 💡 进阶：生产级同步方案
- **测试运行**：`rsync -avn source/ dest/` (加 `-n` 或 `--dry-run` 模拟执行，防止误删)。
- **完全一致**：`rsync -av --delete source/ dest/` (删除目标端多余的文件，保持镜像一致)。
- **排除文件**：`rsync -av --exclude 'node_modules' --exclude '*.log' source/ dest/`。
- **限速传输**：`--bwlimit=1000` (单位 KB/s，防止占满带宽)。

#### 🔒 SSH 生产力技巧：~/.ssh/config
别再背诵 `ssh -p 2222 user@1.2.3.4` 了！通过配置文件，你可以给服务器起“绰号”。

在本地创建或编辑 `~/.ssh/config`：
```ssh config
Host mysrv
    HostName 1.2.3.4
    User root
    Port 2222
    IdentityFile ~/.ssh/id_rsa
```
**效果**：现在只需输入 `ssh mysrv` 即可一键登录。

#### 🚀 SSH 端口转发 (隧道)
- **本地转发**：`ssh -L 本地端口:目标主机:目标端口 user@中转服务器`
  - **场景 (家庭办公)**：你想在家里访问公司内网服务器 A (IP: 192.168.1.50) 的网页 (80 端口)。你无法直接连 A，但你可以 SSH 连上公司的一台跳板机 B。
  - **命令**：`ssh -L 8080:192.168.1.50:80 user@跳板机B`
  - **效果**：在家里浏览器打开 `http://localhost:8080`，流量会通过加密隧道“瞬移”到公司内网 A 的 80 端口。

#### 免密登录 (SSH Key)
1. `ssh-keygen`：生成密钥对。
2. `ssh-copy-id user@host`：将公钥发送给服务器，实现免密登录。

> **🧗 进阶阅读**：
> 想知道三次握手到底发了什么包？想深入了解防火墙和 eBPF？
> 请阅读：[03_网络底层与安全](../05_高级/03_网络底层与安全.md)