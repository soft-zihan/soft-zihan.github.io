# 🔐 权限与安全 (Permissions & Security)

## 1. chmod (Change Mode) - 理解权限位
Linux 权限由三组 `rwx` 组成：**所有者 (User)**、**属组 (Group)**、**其他人 (Others)**。

#### 💡 核心 1：rwx 对不同对象的含义
| 权限 | 对文件 (File) | 对目录 (Directory) | 数值 |
| :--- | :--- | :--- | :--- |
| **r** (Read) | 查看文件内容 | **列出**目录下的文件名 (`ls`) | **4** |
| **w** (Write) | 修改文件内容 | **增删**目录下的文件 (`touch/rm`) | **2** |
| **x** (eXecute) | 作为脚本/程序执行 | **进入**该目录 (`cd`) | **1** |

#### 💡 核心 2：数值权限计算 (Octal Mode)
权限是通过将 `r(4), w(2), x(1)` 相加得到的：
- `7` = 4+2+1 (rwx)
- `6` = 4+2 (rw-)
- `5` = 4+1 (r-x)
- **示例**：`chmod 755` -> 所有者 7(rwx)，组 5(r-x)，其他人 5(r-x)。

- **常用方案**：
  - `chmod 755`：标准目录权限。
  - `chmod 644`：标准文件权限。
  - `chmod 600`：私密文件 (如 SSH 密钥)，仅所有者读写。
- **💡 符号模式 (Symbolic Mode)**：对于初学者，这种写法更直观。
  - **`chmod +x script.sh`**：给文件增加可执行权限 (最常用)。
  - `chmod u+w file`：给所有者 (User) 增加写权限。
  - `chmod g-r file`：移除所属组 (Group) 的读权限。
  - `chmod a+x file`：给所有人 (All) 增加执行权限。
- `chmod -R`：递归修改目录下所有文件的权限。

---

### 2. chown / chgrp - 修改所属
- `chown user:group file`：同时修改所有者和所属组。
- `chgrp group file`：**仅修改所属组**。
- `chown -R user:group /dir`：递归修改。

---

### 3. root / sudo / su - 身份切换

#### 👑 Root：系统的“上帝”
Linux 中有一个超级用户叫 **root**。它拥有不受限制的权限，可以删除系统中的任何文件。为了安全，日常操作**绝不要**直接登录 root 账号。

#### 🛡️ sudo (SuperUser DO)
当你执行需要权限的操作时（如安装软件），在命令前加 `sudo`。
- `sudo apt update`：以管理员身份运行。
- **神技**：`sudo !!`。当你输入了一个长长的命令却提示 `Permission denied` 时，输入它，系统会自动补全上一条命令并加上 sudo。

#### 👤 su vs su -
- **`su user` (Switch User)**：切换到某个用户，但**保留**当前的环境变量。
  - *例子*：如果你在 `/home/han/work` 下执行，切换后你还在这个目录，且你的 `PATH` 可能还是旧用户的。
- **`su - user` (Login Shell)**：切换到某个用户，并**加载其完整的家目录和环境**。
  - *例子*：执行后会自动跳到该用户的家目录 (`~`)，加载该用户的 `.bashrc` 配置。**在生产环境下，推荐永远使用 `su -` 以避免路径混乱**。

#### 💡 推荐：`sudoedit`
- **场景**：当你需要修改 `/etc/hosts` 等系统文件时。
- **优点**：它会将文件拷贝到临时目录，用你**当前用户的编辑器配置**打开，保存后再写回。这比直接 `sudo vi` 更安全，因为它不会以 root 身份运行你的编辑器插件 (防止脚本注入)。
- **配置**：它会读取你的 `EDITOR` 变量。你可以执行 `export EDITOR=vim` 来指定它使用 Vim。

---

### 4. 用户管理与身份查询
- `sudo useradd -m username`：创建用户并自动生成家目录。
- **`passwd`**：修改当前用户密码。
- **`sudo passwd username`**：管理员修改指定用户的密码。
- **`sudo userdel -r username`**：删除用户及其家目录。
- `id`：显示当前用户 UID、GID 及所属组。
- `whoami`：显示当前用户名。
- `groups`：查看用户所在的组。

---

### 5. 审计与登录信息
- `w`：实时查看当前有哪些用户在线，以及他们正在运行什么命令。
- `who`：显示当前登录的用户列表。
- `last -n 10`：查看最近 10 次用户登录记录 (排查服务器是否被非法侵入)。
