# 04-B. 插槽系统（Slots）🎁

> **学习目标**: 理解插槽的三个层次（基础、具名、作用域），掌握组件复用的核心技能。  
> **实践基地**: [🎁 插槽系统实验室](../../../)

## 1. 什么是插槽？为什么需要它？

在现实中，有些组件是**通用的**。例如：

- 📦 盒子（Box）组件 - 需要放不同的东西（文本、图片、按钮）
- 🎴 卡片（Card）组件 - 需要显示不同的内容
- 🏠 页面布局 - 需要替换不同的主要内容

如果没有插槽，我们需要为每种情况创建新组件：

```vue
<!-- ❌ 不好的做法：重复创建组件 -->
<TextCard />
<ImageCard />
<ButtonCard />
```

但用插槽，只需一个组件就能搞定所有情况。

---

## 2. 基础插槽（Default Slot）

### 原理

插槽就像是组件中的**占位符**。父组件可以告诉子组件："在这个位置，放我给你的内容"。

### 子组件定义插槽

```vue
<!-- Card.vue - 子组件 -->
<template>
  <div class="card">
    <h2 class="card-title">卡片标题</h2>
    
    <!-- 这就是插槽：父组件可以在这里放内容 -->
    <slot></slot>
    
    <div class="card-footer">页脚</div>
  </div>
</template>

<style scoped>
.card {
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 8px;
}
</style>
```

### 父组件使用插槽

```vue
<!-- Parent.vue - 父组件 -->
<template>
  <div>
    <!-- 在 <Card> 标签内放的内容，会被插入到子组件的 <slot> 位置 -->
    <Card>
      <p>这是我想显示的内容</p>
      <button>我的按钮</button>
    </Card>
  </div>
</template>

<script setup>
import Card from './Card.vue';
</script>
```

### 效果

```
┌─────────────────────┐
│  卡片标题           │
├─────────────────────┤
│ 这是我想显示的内容   │
│ 我的按钮            │
├─────────────────────┤
│  页脚               │
└─────────────────────┘
```

### 默认内容

如果父组件没有给插槽提供内容，可以定义默认内容：

```vue
<!-- Card.vue -->
<template>
  <div class="card">
    <slot>
      <!-- 这是默认内容，如果父组件没有提供内容就显示这个 -->
      <p>默认内容：没有提供任何东西</p>
    </slot>
  </div>
</template>
```

---

## 3. 具名插槽（Named Slots）

当组件中有**多个位置**需要插槽时，就要用具名插槽来区分。

### 场景：用户资料卡

我们需要三个区域：**头部**、**内容**、**底部**。

### 子组件定义具名插槽

```vue
<!-- UserProfile.vue -->
<template>
  <div class="profile">
    <!-- 头部插槽 -->
    <div class="header">
      <slot name="header">
        <p>默认头部</p>
      </slot>
    </div>

    <!-- 内容插槽（没有 name 属性，这是默认插槽） -->
    <div class="content">
      <slot>
        <p>默认内容</p>
      </slot>
    </div>

    <!-- 底部插槽 -->
    <div class="footer">
      <slot name="footer">
        <p>默认底部</p>
      </slot>
    </div>
  </div>
</template>

<style scoped>
.profile {
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
}

.header {
  background: #f5f5f5;
  padding: 20px;
  border-bottom: 1px solid #ddd;
}

.content {
  padding: 20px;
}

.footer {
  background: #f5f5f5;
  padding: 20px;
  border-top: 1px solid #ddd;
}
</style>
```

### 父组件使用具名插槽

```vue
<!-- Parent.vue -->
<template>
  <UserProfile>
    <!-- 用 template 标签和 #slot-name 来指定内容放在哪个插槽 -->
    
    <template #header>
      <h2>👨‍💻 张三</h2>
      <p>Vue 开发者</p>
    </template>

    <!-- 默认插槽（不需要指定名字） -->
    <template #default>
      <p>我是一个热爱前端开发的工程师。</p>
      <p>专注于 Vue 和 React。</p>
    </template>

    <template #footer>
      <button>关注</button>
      <button>消息</button>
    </template>
  </UserProfile>
</template>

<script setup>
import UserProfile from './UserProfile.vue';
</script>
```

### 简化语法

如果只有默认插槽，可以直接在组件标签内写内容：

```vue
<!-- 简化方式 -->
<Card>
  <p>直接写在这里</p>
</Card>

<!-- 等价于 -->
<Card>
  <template #default>
    <p>直接写在这里</p>
  </template>
</Card>
```

---

## 4. 作用域插槽（Scoped Slots）

作用域插槽的特点是：**子组件可以向父组件传递数据**。

### 场景：列表渲染

想象一个列表组件，它有一个水果数组，但每个水果如何显示由**父组件决定**。

### 子组件定义作用域插槽

```vue
<!-- FruitList.vue -->
<template>
  <div class="list">
    <!-- 遍历水果列表 -->
    <div v-for="(fruit, index) in fruits" :key="index" class="item">
      <!-- 通过属性传递数据给父组件 -->
      <slot 
        :fruit="fruit" 
        :index="index"
        :isEven="index % 2 === 0"
      >
        <!-- 默认显示方式 -->
        {{ index + 1 }}. {{ fruit.name }}
      </slot>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const fruits = ref([
  { name: '苹果', icon: '🍎', price: 5 },
  { name: '香蕉', icon: '🍌', price: 3 },
  { name: '葡萄', icon: '🍇', price: 8 },
  { name: '橙子', icon: '🍊', price: 4 }
]);
</script>
```

### 父组件接收作用域插槽的数据

```vue
<!-- Parent.vue -->
<template>
  <FruitList>
    <!-- 通过 #default="{ fruit, index, isEven }" 接收子组件传来的数据 -->
    <template #default="{ fruit, index, isEven }">
      <div 
        class="fruit-item"
        :class="{ 'even-row': isEven }"
      >
        <span class="fruit-icon">{{ fruit.icon }}</span>
        <span class="fruit-name">{{ fruit.name }}</span>
        <span class="fruit-price">¥{{ fruit.price }}</span>
      </div>
    </template>
  </FruitList>
</template>

<script setup>
import FruitList from './FruitList.vue';
</script>

<style scoped>
.fruit-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 4px;
}

.even-row {
  background: #f5f5f5;
}
</style>
```

### 实际例子：表格渲染

```vue
<!-- DataTable.vue - 通用表格组件 -->
<template>
  <table>
    <thead>
      <tr>
        <th v-for="col in columns" :key="col">{{ col }}</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(item, index) in data" :key="index">
        <td v-for="col in columns" :key="col">
          <!-- 插槽让父组件决定如何显示每个单元格 -->
          <slot 
            :name="`cell-${col}`" 
            :value="item[col]"
            :item="item"
          >
            {{ item[col] }}
          </slot>
        </td>
      </tr>
    </tbody>
  </table>
</template>

<script setup>
defineProps<{
  columns: string[];
  data: Array<Record<string, any>>;
}>();
</script>
```

使用通用表格：

```vue
<DataTable :columns="['name', 'status', 'action']" :data="users">
  <!-- 自定义 name 列的显示 -->
  <template #cell-name="{ value }">
    <strong>{{ value }}</strong>
  </template>

  <!-- 自定义 status 列的显示 -->
  <template #cell-status="{ value }">
    <span :class="{ 'text-green': value === 'active' }">
      {{ value }}
    </span>
  </template>

  <!-- 自定义 action 列的显示 -->
  <template #cell-action="{ item }">
    <button @click="edit(item)">编辑</button>
  </template>
</DataTable>
```

---

## 5. 对比：三种插槽

| 类型 | 用法 | 场景 |
|------|------|------|
| **基础插槽** | `<slot></slot>` | 组件有单一内容区域 |
| **具名插槽** | `<slot name="header"></slot>` | 组件有多个区域（如布局） |
| **作用域插槽** | `<slot :data="item"></slot>` | 子组件向父组件传递数据 |

---

## 6. 常见错误与最佳实践

### ❌ 错误 1：忘记 template 标签

```vue
<!-- ❌ 错误：直接写在具名插槽 -->
<Card>
  #header
  <h1>标题</h1>
</Card>

<!-- ✅ 正确 -->
<Card>
  <template #header>
    <h1>标题</h1>
  </template>
</Card>
```

### ❌ 错误 2：混淆 slot 和 v-slot

```vue
<!-- ❌ 这是错的 -->
<template slot="header">...</template>

<!-- ✅ 正确的新语法 -->
<template #header>...</template>
```

### ✅ 最佳实践：使用描述性的插槽名

```vue
<!-- ❌ 不清楚 -->
<slot name="a"></slot>
<slot name="b"></slot>

<!-- ✅ 清楚 -->
<slot name="header"></slot>
<slot name="content"></slot>
<slot name="footer"></slot>
```

---

## 7. 为什么使用插槽？

### 提高组件复用性

```vue
<!-- 同一个 Card 组件可以显示不同内容 -->
<Card>
  <img src="..." />
</Card>

<Card>
  <video src="..."></video>
</Card>

<Card>
  <form>...</form>
</Card>
```

### 灵活的布局

```vue
<!-- 父组件完全控制 Card 内部的结构 -->
<Card>
  <div class="custom-layout">
    <span>自定义布局</span>
  </div>
</Card>
```

### 避免 props 爆炸

```vue
<!-- ❌ 不好：需要很多 props -->
<ImageCard 
  :title="title"
  :description="description"
  :imageUrl="url"
  :footerText="text"
/>

<!-- ✅ 更好：用插槽 -->
<Card>
  <template #header>{{ title }}</template>
  <img :src="url" />
  <template #footer>{{ text }}</template>
</Card>
```

---

## 8. 总结

| 概念 | 定义 | 语法 |
|------|------|------|
| **基础插槽** | 子组件的内容占位符 | `<slot></slot>` |
| **具名插槽** | 多个命名的插槽 | `<slot name="x"></slot>` |
| **作用域插槽** | 向父组件传递数据 | `<slot :prop="value"></slot>` |
| **插槽内容** | 父组件填充的内容 | `<template #name>...</template>` |

---

## 📚 扩展阅读

- [Vue 官方文档 - 插槽](https://vuejs.org/guide/components/slots.html)
- [高级插槽模式](https://vuejs.org/guide/components/slots.html#render-function-slots)

## 🧪 实践

打开 [🎁 插槽系统实验室](../../../) 来进行交互式学习！

