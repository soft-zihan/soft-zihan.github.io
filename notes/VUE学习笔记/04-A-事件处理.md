# 04-A. 事件处理与事件系统 🖱️

> **学习目标**: 理解 Vue 的事件系统，掌握 @click 语法、事件修饰符和键盘事件的用法。  
> **实践基地**: [🧪 事件处理实验室](../../../)

## 1. 为什么需要事件处理？

Web 应用是**交互式的**。用户会与页面交互：

- 点击按钮
- 输入文字
- 按键盘
- 鼠标移动

Vue 需要**监听**这些事件，然后执行相应的代码逻辑。

### 原生 JavaScript 的方式（繁琐）

```javascript
// ❌ 传统方式
const button = document.getElementById('btn');
button.addEventListener('click', () => {
  console.log('Button clicked!');
});
```

### Vue 的方式（简洁）

```vue
<!-- ✅ Vue 方式 -->
<template>
  <button @click="handleClick">点击我</button>
</template>

<script setup>
const handleClick = () => {
  console.log('Button clicked!');
};
</script>
```

---

## 2. 基础：@click 事件绑定

### 语法形式

Vue 使用 `@事件名` 来监听事件。最常见的就是 `@click`。

```vue
<template>
  <!-- 调用方法 -->
  <button @click="increment">次数: {{ count }}</button>
  
  <!-- 带参数 -->
  <button @click="add(5)">加 5</button>
  
  <!-- 访问事件对象 -->
  <button @click="handleEvent($event)">获取事件</button>
</template>

<script setup>
import { ref } from 'vue';

const count = ref(0);

const increment = () => {
  count.value++;
};

const add = (n) => {
  count.value += n;
};

const handleEvent = (event) => {
  console.log(event); // PointerEvent 对象
  console.log(event.target); // 被点击的元素
};
</script>
```

### 常见错误

```vue
<!-- ❌ 错误：忘记加括号 -->
<button @click="increment">{{ count }}</button>

<!-- ✅ 正确 -->
<button @click="increment()">{{ count }}</button>
```

---

## 3. 事件修饰符（Event Modifiers）

Vue 提供了**事件修饰符**来简化常见的事件处理场景。

### 常用修饰符

| 修饰符 | 作用 | 原生 JavaScript 等价 |
|--------|------|-------------------|
| `.stop` | 阻止事件冒泡 | `event.stopPropagation()` |
| `.prevent` | 阻止默认行为 | `event.preventDefault()` |
| `.once` | 只执行一次 | 需要手动记录标志位 |
| `.self` | 仅在点击元素本身时触发 | 需要检查 `event.target` |

### 例子 1：阻止事件冒泡 (.stop)

```vue
<template>
  <div @click="parentClick" class="parent">
    父层被点击了 {{ parentCount }}
    
    <!-- 不使用 .stop -->
    <button @click="childClick" class="child">
      子按钮（会冒泡）
    </button>
    
    <!-- 使用 .stop -->
    <button @click.stop="childClickStop" class="child">
      子按钮（不冒泡）✅
    </button>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const parentCount = ref(0);

const parentClick = () => {
  parentCount.value++;
};

const childClick = () => {
  console.log('子按钮被点击，事件会冒泡到父层');
};

const childClickStop = () => {
  console.log('子按钮被点击，事件不会冒泡');
};
</script>
```

**行为对比**:
- 点击"子按钮（会冒泡）" → 父计数器会增加 ↑
- 点击"子按钮（不冒泡）" → 父计数器不变 ✅

### 例子 2：阻止默认行为 (.prevent)

```vue
<template>
  <!-- 链接不会跳转 -->
  <a href="https://example.com" @click.prevent="handleLinkClick">
    点击不会跳转
  </a>
  
  <!-- 表单不会提交 -->
  <form @submit.prevent="handleSubmit">
    <input type="text" v-model="formData" />
    <button type="submit">提交（不会刷新页面）</button>
  </form>
</template>

<script setup>
import { ref } from 'vue';

const formData = ref('');

const handleLinkClick = () => {
  console.log('链接点击了，但没有跳转');
};

const handleSubmit = () => {
  console.log('表单提交，数据：', formData.value);
};
</script>
```

### 例子 3：只执行一次 (.once)

```vue
<template>
  <!-- 按钮只能点击一次 -->
  <button @click.once="init">
    初始化（只能点击一次）
  </button>
</template>

<script setup>
const init = () => {
  console.log('初始化完成！');
  // 之后再点击这个按钮，什么都不会发生
};
</script>
```

### 修饰符可以链式使用

```vue
<template>
  <!-- 防止默认行为，阻止冒泡，只执行一次 -->
  <form @submit.prevent.stop.once="specialSubmit">
    ...
  </form>
</template>
```

---

## 4. 键盘事件（Keyboard Events）

当用户按下键盘上的按键时触发。

### 基础语法

```vue
<template>
  <!-- 监听任何按键 -->
  <input @keydown="handleKeydown" placeholder="按下任何键" />
  
  <!-- 只监听 Enter 键 -->
  <input @keyup.enter="handleEnter" placeholder="按 Enter" />
  
  <!-- 只监听 ESC 键 -->
  <input @keyup.esc="handleEsc" placeholder="按 ESC" />
</template>

<script setup>
const handleKeydown = (event) => {
  console.log('按下的键：', event.key);
};

const handleEnter = (event) => {
  console.log('回车键被按下');
};

const handleEsc = (event) => {
  console.log('ESC 键被按下');
};
</script>
```

### 常用的键盘修饰符

| 修饰符 | 对应键 |
|--------|---------|
| `.enter` | Enter (回车) |
| `.tab` | Tab |
| `.esc` | ESC |
| `.space` | 空格 |
| `.delete` | Delete / Backspace |
| `.up` / `.down` / `.left` / `.right` | 方向键 |

### 实际例子：搜索框

```vue
<template>
  <div>
    <input 
      v-model="searchText" 
      @keyup.enter="search"
      @keyup.esc="searchText = ''"
      placeholder="搜索（Enter 搜索，ESC 清空）"
    />
    <p v-if="searchResult">搜索结果：{{ searchResult }}</p>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const searchText = ref('');
const searchResult = ref('');

const search = () => {
  searchResult.value = `搜索了："${searchText.value}"`;
};
</script>
```

---

## 5. 鼠标事件

### 常见的鼠标事件

```vue
<template>
  <div 
    @click="handleClick"
    @dblclick="handleDblClick"
    @mousedown="handleMouseDown"
    @mouseup="handleMouseUp"
    @mouseenter="handleMouseEnter"
    @mouseleave="handleMouseLeave"
    class="interactive-box"
  >
    在这个盒子上尝试不同的鼠标操作
  </div>
</template>

<script setup>
const handleClick = () => console.log('点击');
const handleDblClick = () => console.log('双击');
const handleMouseDown = () => console.log('按下鼠标');
const handleMouseUp = () => console.log('释放鼠标');
const handleMouseEnter = () => console.log('鼠标进入');
const handleMouseLeave = () => console.log('鼠标离开');
</script>
```

### 鼠标修饰符

```vue
<template>
  <!-- 只有左键点击 -->
  <button @click.left="handleLeftClick">左键点击</button>
  
  <!-- 只有右键点击 -->
  <button @click.right="handleRightClick">右键点击</button>
  
  <!-- 只有中键点击 -->
  <button @click.middle="handleMiddleClick">中键点击</button>
</template>
```

---

## 6. 表单事件

```vue
<template>
  <div>
    <!-- input 事件（实时触发） -->
    <input 
      @input="handleInput"
      placeholder="边输入边显示"
    />
    <p>当前输入：{{ currentInput }}</p>
    
    <!-- change 事件（失焦时触发） -->
    <select @change="handleChange">
      <option value="">选择一个选项</option>
      <option value="vue">Vue</option>
      <option value="react">React</option>
    </select>
    <p>选择的框架：{{ selectedFramework }}</p>
    
    <!-- focus 和 blur 事件 -->
    <input 
      @focus="isFocused = true"
      @blur="isFocused = false"
      placeholder="点击获得焦点"
    />
    <p v-if="isFocused">输入框已获得焦点 ✨</p>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const currentInput = ref('');
const selectedFramework = ref('');
const isFocused = ref(false);

const handleInput = (event) => {
  currentInput.value = event.target.value;
};

const handleChange = (event) => {
  selectedFramework.value = event.target.value;
};
</script>
```

---

## 7. 常见错误与最佳实践

### ❌ 常见错误 1：模板中调用方法时忘记加括号

```vue
<!-- ❌ 错误 -->
<button @click="handleClick">点击</button>

<!-- ✅ 正确 -->
<button @click="handleClick()">点击</button>
```

### ❌ 常见错误 2：事件冒泡导致意外行为

```vue
<!-- ❌ 问题：点击按钮会同时触发 parentClick -->
<div @click="parentClick">
  <button @click="childClick">按钮</button>
</div>

<!-- ✅ 解决：使用 .stop -->
<div @click="parentClick">
  <button @click.stop="childClick">按钮</button>
</div>
```

### ❌ 常见错误 3：在模板中写复杂逻辑

```vue
<!-- ❌ 不好的做法 -->
<button @click="if (count > 10) alert('太多了'); else count++">
  点击
</button>

<!-- ✅ 好的做法：逻辑写在方法中 -->
<button @click="handleIncrement">点击</button>

<script setup>
const handleIncrement = () => {
  if (count.value > 10) {
    alert('太多了');
  } else {
    count.value++;
  }
};
</script>
```

---

## 8. 总结

| 概念 | 示例 | 作用 |
|------|------|------|
| **事件监听** | `@click="method"` | 监听事件并执行方法 |
| **事件修饰符** | `@click.stop` | 修改事件的默认行为 |
| **键盘修饰符** | `@keyup.enter` | 针对特定按键做处理 |
| **鼠标修饰符** | `@click.left` | 针对特定鼠标按键做处理 |
| **事件对象** | `$event` | 访问原生事件信息 |

---

## 📚 扩展阅读

- [Vue 官方文档 - 事件处理](https://vuejs.org/guide/essentials/event-handling.html)
- [MDN - Event 接口](https://developer.mozilla.org/en-US/docs/Web/API/Event)
- [键盘事件与键码](https://keycode.info/)

## 🧪 实践

打开 [🖱️ 事件处理实验室](../../../) 来进行交互式学习！

